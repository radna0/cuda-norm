# 20B decode throughput: UNION prunes

- prompt_len: 256 | new_tokens: 2048
- batch_sweep: 1,2,4,8,16,32

| run | top_k | max_batch | total tok/s @max | per-stream tok/s @max | mem_used_gib @max | model |
|---|---:|---:|---:|---:|---:|---|
| base_topk4 | 4 | 32 | 588.16 | 18.38 | 20.9 | `openai/gpt-oss-20b` |
| base_topk2 | 2 | 32 | 590.64 | 18.46 | 29.8 | `openai/gpt-oss-20b` |
| union50_topk4 | 4 | 32 | 573.90 | 17.93 | 28.8 | `/root/model/artifacts/20b_union_pruned/union50` |
| union50_topk2 | 2 | 32 | 589.96 | 18.44 | 20.6 | `/root/model/artifacts/20b_union_pruned/union50` |
| unionAgg_topk2 | 2 | 32 | 598.16 | 18.69 | 19.6 | `/root/model/artifacts/20b_union_pruned/unionAgg` |

## Per-batch details

### base_topk4

| batch | total tok/s | per-stream tok/s | decode_s | mem_used_gib | status |
|---:|---:|---:|---:|---:|---|
| 1 | 17.14 | 17.14 | 119.472 | 14.62579345703125 | ok |
| 2 | 35.64 | 17.82 | 114.925 | 14.62579345703125 | ok |
| 4 | 71.41 | 17.85 | 114.720 | 15.03399658203125 | ok |
| 8 | 144.77 | 18.10 | 113.175 | 15.80157470703125 | ok |
| 16 | 296.77 | 18.55 | 110.414 | 17.33673095703125 | ok |
| 32 | 588.16 | 18.38 | 111.426 | 20.90899658203125 | ok |

### base_topk2

| batch | total tok/s | per-stream tok/s | decode_s | mem_used_gib | status |
|---:|---:|---:|---:|---:|---|
| 1 | 17.63 | 17.63 | 116.169 | 24.45196533203125 | ok |
| 2 | 35.30 | 17.65 | 116.045 | 24.45391845703125 | ok |
| 4 | 72.85 | 18.21 | 112.454 | 24.47540283203125 | ok |
| 8 | 142.39 | 17.80 | 115.065 | 25.24298095703125 | ok |
| 16 | 286.16 | 17.89 | 114.509 | 26.77813720703125 | ok |
| 32 | 590.64 | 18.46 | 110.958 | 29.84649658203125 | ok |

### union50_topk4

| batch | total tok/s | per-stream tok/s | decode_s | mem_used_gib | status |
|---:|---:|---:|---:|---:|---|
| 1 | 17.75 | 17.75 | 115.349 | 24.20782470703125 | ok |
| 2 | 35.69 | 17.84 | 114.767 | 24.20977783203125 | ok |
| 4 | 70.62 | 17.66 | 116.001 | 24.23126220703125 | ok |
| 8 | 139.42 | 17.43 | 117.518 | 24.23126220703125 | ok |
| 16 | 295.35 | 18.46 | 110.945 | 25.76641845703125 | ok |
| 32 | 573.90 | 17.93 | 114.193 | 28.83477783203125 | ok |

### union50_topk2

| batch | total tok/s | per-stream tok/s | decode_s | mem_used_gib | status |
|---:|---:|---:|---:|---:|---|
| 1 | 17.75 | 17.75 | 115.378 | 15.26055908203125 | ok |
| 2 | 35.83 | 17.92 | 114.308 | 15.26251220703125 | ok |
| 4 | 72.02 | 18.00 | 113.752 | 15.27423095703125 | ok |
| 8 | 144.10 | 18.01 | 113.702 | 16.04180908203125 | ok |
| 16 | 283.44 | 17.72 | 115.608 | 17.57696533203125 | ok |
| 32 | 589.96 | 18.44 | 111.085 | 20.64532470703125 | ok |

### unionAgg_topk2

| batch | total tok/s | per-stream tok/s | decode_s | mem_used_gib | status |
|---:|---:|---:|---:|---:|---|
| 1 | 17.92 | 17.92 | 114.280 | 14.99688720703125 | ok |
| 2 | 35.53 | 17.77 | 115.271 | 14.99884033203125 | ok |
| 4 | 71.77 | 17.94 | 114.144 | 15.02032470703125 | ok |
| 8 | 143.28 | 17.91 | 114.351 | 15.02032470703125 | ok |
| 16 | 285.69 | 17.86 | 114.699 | 16.55548095703125 | ok |
| 32 | 598.16 | 18.69 | 109.563 | 19.62384033203125 | ok |

## Reproduce

```bash
modal run modal/benchmark_decode_throughput_union.py --prompt-len 256 --new-tokens 2048 --batch-sizes 1,2,4,8,16,32
```
